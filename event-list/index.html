<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Poster Generator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas library for converting HTML to image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- VanillaJS Datepicker for calendar input -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/css/datepicker-bs5.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/js/datepicker-full.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Apply the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* The container that will be captured */
        #poster-content {
            width: 1080px;
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: color 0.3s ease;
        }

        /* Default Story Size (1080x1920) */
        #poster-content.size-story {
            height: 1920px;
            padding: 96px;
        }
        #poster-content.size-story .event-list-container {
             flex-grow: 1;
        }

        /* Post Size (1080x1350) */
        #poster-content.size-post {
            height: 1350px;
            padding: 64px;
        }
        
        #poster-content.size-post #poster-header {
             margin-top: 24px; /* Added margin to push title down */
        }

        #poster-content.size-post .event-list-container {
            height: 874px; /* Adjusted height to compensate for reduced margin */
            flex-grow: 0;
            flex-shrink: 0;
            border-top: 2px solid rgba(255,255,255,0.15);
            border-bottom: 2px solid rgba(255,255,255,0.15);
            margin: 20px 0; /* Reduced top/bottom margin to move list up */
            padding-top: 32px;
            padding-bottom: 32px;
            padding-left: 0; /* Override Tailwind's px-4 to widen content */
            padding-right: 0; /* Override Tailwind's px-4 to widen content */
        }
         #poster-content.size-post #poster-footer-wrapper {
            margin-top: 0; /* Override default margin */
         }


        /* Styling for the scrollbar for better aesthetics and readability */
        .event-list-container::-webkit-scrollbar {
            width: 12px;
        }
        .event-list-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .event-list-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 3px solid transparent;
            background-clip: content-box;
        }
        .event-list-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        /* Hide action buttons during canvas generation */
        .html2canvas-container .action-buttons {
            display: none;
        }
        
        /* Custom styles for the datepicker */
        .datepicker-picker {
            background-color: #374151; /* gray-700 */
            border-radius: 1rem;
            border: 1px solid #4b5563; /* gray-600 */
        }
        .datepicker-picker span {
             color: #d1d5db; /* gray-300 */
        }
        .datepicker-picker .datepicker-cell:not(.disabled):hover, .datepicker-picker .datepicker-cell.focused:not(.selected) {
            background-color: #4b5563; /* gray-600 */
        }
        .datepicker-picker .datepicker-cell.selected, .datepicker-picker .datepicker-cell.selected:hover {
             background-color: #4f46e5; /* indigo-600 */
             color: #fff;
        }
        .datepicker-picker .datepicker-cell.today:not(.selected){
            background-color: #374151;
            border: 1px solid #9ca3af;
        }
        .datepicker-controls {
            background-color: #4b5563; /* gray-600 */
        }
        .datepicker-controls .btn {
            color: #d1d5db !important; /* gray-300 */
            text-transform: uppercase;
            font-weight: bold;
        }
        .datepicker-controls .btn:hover {
             background-color: #374151 !important; /* gray-700 */
        }
        
        .action-buttons button:disabled {
            opacity: 0.2;
            cursor: not-allowed;
        }
        
        /* Style for directly editable text on the canvas */
        [contenteditable="true"] {
            cursor: text;
        }
        [contenteditable="true"]:focus {
            outline: 2px dashed rgba(139, 148, 162, 0.5); /* A soft outline for editing */
            box-shadow: 0 0 15px rgba(139, 148, 162, 0.2);
            border-radius: 8px;
        }
        
        /* Style for the status message */
        #status-message {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
        }
        #status-message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Text Effects */
        .text-effect-shadow {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
        }
        .text-effect-glow {
             text-shadow: 0 0 8px rgba(255, 255, 255, 0.5), 0 0 10px rgba(255, 255, 255, 0.3);
        }

    </style>
</head>
<body class="bg-gray-800 text-white">

    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold tracking-tight">Social Media Event Poster Generator</h1>
            <p class="text-gray-400 mt-2 max-w-3xl mx-auto">Create your event poster by adding events and customizing the design. You can edit text directly on the preview. If your list is too long, multiple images will be generated automatically. Your work is saved in your browser.</p>
        </header>
        
        <input type="file" id="import-input" class="hidden" accept=".json">


        <div class="flex flex-col lg:grid lg:grid-cols-3 lg:gap-8">

            <!-- Left Column: Event Details Form -->
            <div class="lg:col-span-1 bg-gray-900 p-6 rounded-2xl shadow-lg">
                 <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Event Details</h2>
                <form id="event-form" class="space-y-4">
                    <div>
                        <label for="event-name" class="block text-sm font-medium text-gray-300">Event Name</label>
                        <input type="text" id="event-name" name="event-name" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="event-date" class="block text-sm font-medium text-gray-300">Date</label>
                        <div class="flex items-center space-x-4 mt-1">
                            <input type="text" id="event-date" name="event-date" placeholder="Select a date" required class="block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2" autocomplete="off">
                            <div class="flex items-center">
                                <input id="is-date-tba" name="is-date-tba" type="checkbox" class="h-4 w-4 text-yellow-500 focus:ring-yellow-400 border-gray-600 rounded bg-gray-700">
                                <label for="is-date-tba" class="ml-2 block text-sm text-gray-300">TBA</label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="event-location" class="block text-sm font-medium text-gray-300">Location</label>
                        <input type="text" id="event-location" name="event-location" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                     <div>
                        <label for="event-social" class="block text-sm font-medium text-gray-300">Social Media Handle</label>
                        <input type="text" id="event-social" name="event-social" placeholder="@username" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="event-price" class="block text-sm font-medium text-gray-300">Ticket Price (IDR)</label>
                        <div class="flex items-center space-x-4 mt-1">
                            <input type="number" id="event-price" name="event-price" placeholder="50000" class="block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                             <div class="flex items-center">
                                <input id="is-free" name="is-free" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-600 rounded bg-gray-700">
                                <label for="is-free" class="ml-2 block text-sm text-gray-300">Free</label>
                            </div>
                             <div class="flex items-center">
                                <input id="is-tba" name="is-tba" type="checkbox" class="h-4 w-4 text-yellow-500 focus:ring-yellow-400 border-gray-600 rounded bg-gray-700">
                                <label for="is-tba" class="ml-2 block text-sm text-gray-300">TBA</label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md">
                        Add Event to List
                    </button>
                </form>
            </div>

            <!-- Middle Column: Poster Preview -->
            <div class="lg:col-span-1 flex-1 flex flex-col items-center">
                <h2 class="text-2xl font-bold mb-4 text-center">Poster Preview</h2>
                <!-- Container for the scaled preview. It sets the size and clips. -->
                <div id="preview-wrapper" class="w-full max-w-[360px] md:max-w-[450px] shadow-2xl rounded-xl overflow-hidden bg-gray-900">
                    <!-- This div is scaled by JavaScript to fit the container above -->
                    <div id="poster-scaler" class="origin-top-left">
                        <!-- The actual poster content that will be rendered -->
                        <div id="poster-content" class="text-white">
                            <div id="poster-background-overlay" class="absolute inset-0 z-0"></div>
                            <header id="poster-header" class="text-center relative z-10 flex-shrink-0">
                                <h1 id="preview-title" class="font-black tracking-tighter uppercase" contenteditable="true" data-setting="title"></h1>
                                <p id="preview-subtitle" class="text-5xl text-gray-400 mt-2" contenteditable="true" data-setting="subtitle"></p>
                            </header>
                            <!-- Using class instead of ID for safer cloning -->
                            <main class="event-list-container overflow-y-auto py-8 px-4 relative z-10">
                                <!-- Events will be dynamically inserted here -->
                            </main>
                            <div id="poster-footer-wrapper" class="mt-auto pt-4 relative z-10 flex-shrink-0">
                                <p id="preview-timestamp" class="text-center text-gray-500 text-xl mb-2"></p>
                                <footer id="preview-footer" class="text-center text-gray-500 text-2xl" contenteditable="true" data-setting="footer"></footer>
                                <p id="preview-url" class="text-center text-gray-600 text-lg mt-1"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Other Controls -->
            <div class="lg:col-span-1 bg-gray-900 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Poster Customization</h2>
                <div class="space-y-4">
                    <div>
                        <label for="poster-size" class="block text-sm font-medium text-gray-300">Poster Size</label>
                        <select id="poster-size" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                            <option value="1080x1920">1080 x 1920 (Story)</option>
                            <option value="1080x1350">1080 x 1350 (Post 4:5)</option>
                        </select>
                    </div>
                    <div>
                        <label for="poster-title" class="block text-sm font-medium text-gray-300">Title</label>
                        <input type="text" id="poster-title" name="poster-title" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="title-font-size" class="block text-sm font-medium text-gray-300">Title Font Size: <span id="font-size-value">98</span>px</label>
                        <input type="range" id="title-font-size" min="80" max="200" value="98" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <p id="font-size-recommendation" class="text-xs text-gray-500 mt-1"></p>
                    </div>
                    <div>
                        <label for="poster-subtitle" class="block text-sm font-medium text-gray-300">Subtitle</label>
                        <input type="text" id="poster-subtitle" name="poster-subtitle" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="poster-background" class="block text-sm font-medium text-gray-300">Background Preset</label>
                        <select id="poster-background" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                            <option value="deep-space">Deep Space (Default)</option>
                            <option value="sunset">Sunset</option>
                            <option value="oceanic">Oceanic</option>
                            <option value="minty">Minty</option>
                            <option value="royal">Royal</option>
                            <option value="gotham">Gotham</option>
                            <option value="custom">Custom Gradient</option>
                        </select>
                    </div>
                    <div id="custom-gradient-controls" class="hidden space-y-2">
                        <div class="flex items-center gap-4">
                            <label for="gradient-start-color" class="text-sm font-medium text-gray-300">Start</label>
                            <input type="color" id="gradient-start-color" class="p-1 h-10 w-full block bg-gray-700 border-gray-600 cursor-pointer rounded-lg disabled:opacity-50 disabled:pointer-events-none">
                        </div>
                        <div class="flex items-center gap-4">
                            <label for="gradient-end-color" class="text-sm font-medium text-gray-300">End</label>
                             <input type="color" id="gradient-end-color" class="p-1 h-10 w-full block bg-gray-700 border-gray-600 cursor-pointer rounded-lg disabled:opacity-50 disabled:pointer-events-none">
                        </div>
                    </div>
                    
                    <!-- Text Style Controls -->
                    <div class="border-t border-gray-700 pt-4">
                         <h3 class="text-lg font-bold mb-2">Text Style</h3>
                         <div class="space-y-4">
                             <div>
                                 <label for="text-color" class="block text-sm font-medium text-gray-300">Text Color</label>
                                 <input type="color" id="text-color" class="p-1 h-10 w-full block bg-gray-700 border-gray-600 cursor-pointer rounded-lg">
                             </div>
                              <div>
                                 <label for="text-effect" class="block text-sm font-medium text-gray-300">Text Effect</label>
                                 <select id="text-effect" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                                     <option value="none">None</option>
                                     <option value="shadow">Shadow</option>
                                     <option value="glow">Glow</option>
                                 </select>
                             </div>
                         </div>
                    </div>

                     <div class="border-t border-gray-700 pt-4">
                        <label for="poster-footer" class="block text-sm font-medium text-gray-300">Footer Text</label>
                        <input type="text" id="poster-footer" name="poster-footer" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                     <div>
                        <label for="events-per-page" class="block text-sm font-medium text-gray-300">Events Per Image</label>
                        <input type="number" id="events-per-page" name="events-per-page" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                        <p id="events-per-page-recommendation" class="text-xs text-gray-500 mt-1"></p>
                    </div>
                    <div class="flex items-center">
                        <input id="show-timestamp" name="show-timestamp" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-600 rounded bg-gray-700">
                        <label for="show-timestamp" class="ml-2 block text-sm text-gray-300">Show Generation Timestamp</label>
                    </div>
                     <div class="flex items-center">
                        <input id="show-url" name="show-url" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-600 rounded bg-gray-700">
                        <label for="show-url" class="ml-2 block text-sm text-gray-300">Show Page URL</label>
                    </div>
                </div>
                
                 <!-- Status Message Area -->
                <div id="status-container" class="mt-4 h-8">
                     <div id="status-message" class="text-center text-green-400 font-semibold"></div>
                </div>


                <!-- List Management Controls -->
                <div class="mt-4">
                     <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">List Management</h2>
                     <div class="space-y-2">
                         <button id="sort-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            <span>Sort by Date</span>
                        </button>
                        <button id="export-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                            <span>Export Data</span>
                        </button>
                         <button id="import-btn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l4 4m0 0l-4 4m4-4H4" /></svg>
                            <span>Import Data</span>
                        </button>
                        <button id="clear-btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            <span>Clear All Events</span>
                        </button>
                    </div>
                </div>

                <!-- Download Controls -->
                <div class="mt-8">
                     <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Download</h2>
                     <button id="download-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        <span>Generate & Download Image</span>
                    </button>
                    <div id="loading-indicator" class="hidden text-center mt-4 text-yellow-400">Generating image... please wait.</div>
                </div>
            </div>

        </div>
    </div>
    
    <!-- Custom Modal -->
    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex justify-center items-center p-4 transition-opacity duration-300">
        <div class="bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md text-center transform scale-95 transition-transform duration-300">
            <h3 id="modal-title" class="text-xl font-bold mb-4">Modal Title</h3>
            <p id="modal-message" class="text-gray-300 mb-6">Modal message goes here.</p>
            <div id="modal-buttons" class="flex justify-center space-x-4">
                <!-- Buttons will be injected here by JS -->
            </div>
        </div>
    </div>


    <script>
    // --- IIFE Wrapper to encapsulate the entire script ---
    (function() {
        // --- CONFIGURATION CONSTANTS ---
        const CONFIG = {
            LOCAL_STORAGE_KEY: 'posterGeneratorState',
            DEBOUNCE_DELAY: 300,
            STATUS_MESSAGE_DURATION: 2000,
        };

        // --- DOM REFERENCES ---
        const getEl = (id) => document.getElementById(id);
        const queryEl = (selector) => document.querySelector(selector);
        
        // Form & Controls
        const eventForm = getEl('event-form');
        const eventNameInput = getEl('event-name');
        const eventDateInput = getEl('event-date');
        const isDateTbaCheckbox = getEl('is-date-tba');
        const eventLocationInput = getEl('event-location');
        const eventSocialInput = getEl('event-social');
        const eventPriceInput = getEl('event-price');
        const isFreeCheckbox = getEl('is-free');
        const isTbaCheckbox = getEl('is-tba');
        const posterSizeSelect = getEl('poster-size');
        const posterTitleInput = getEl('poster-title');
        const posterSubtitleInput = getEl('poster-subtitle');
        const posterBackgroundSelect = getEl('poster-background');
        const posterFooterInput = getEl('poster-footer');
        const eventsPerPageInput = getEl('events-per-page');
        const showTimestampCheckbox = getEl('show-timestamp');
        const showUrlCheckbox = getEl('show-url');
        const titleFontSizeSlider = getEl('title-font-size');
        const fontSizeValueSpan = getEl('font-size-value');
        const fontSizeRecommendation = getEl('font-size-recommendation');
        const eventsPerPageRecommendation = getEl('events-per-page-recommendation');
        const customGradientControls = getEl('custom-gradient-controls');
        const gradientStartColorInput = getEl('gradient-start-color');
        const gradientEndColorInput = getEl('gradient-end-color');
        const textColorInput = getEl('text-color');
        const textEffectSelect = getEl('text-effect');
        
        // Buttons & Indicators
        const downloadBtn = getEl('download-btn');
        const clearBtn = getEl('clear-btn');
        const sortBtn = getEl('sort-btn');
        const exportBtn = getEl('export-btn');
        const importBtn = getEl('import-btn');
        const importInput = getEl('import-input');
        const loadingIndicator = getEl('loading-indicator');
        const statusMessage = getEl('status-message');

        // Preview Area
        const previewWrapper = getEl('preview-wrapper');
        const posterScaler = getEl('poster-scaler');
        const posterContent = getEl('poster-content');
        const posterBackgroundOverlay = getEl('poster-background-overlay');
        const previewTitle = getEl('preview-title');
        const previewSubtitle = getEl('preview-subtitle');
        const previewListContainer = queryEl('#poster-content .event-list-container');
        const previewTimestamp = getEl('preview-timestamp');
        const previewFooter = getEl('preview-footer');
        const previewUrl = getEl('preview-url');

        // Modal
        const modal = getEl('custom-modal');
        const modalTitle = getEl('modal-title');
        const modalMessage = getEl('modal-message');
        const modalButtons = getEl('modal-buttons');

        let datepickerInstance;

        // --- DATA STATE (PRE-POPULATED) ---
        let events = [
            { "name": "Nihon no Matsuri 16", "date": "21/06/2025", "location": "Telkom University, Bojongsoang, Bandung", "socialMedia": "@nihonnomatsuri", "priceText": "Rp 25.000", "isFree": false },
            { "name": "Bunka no Hi", "date": "28/06/2025", "location": "Cihampelas Walk, Bandung", "socialMedia": "@bunkanohi_", "priceText": "Free", "isFree": true },
            { "name": "Bandung Lautan Creator Day 2", "date": "29/06/2025", "location": "Selah Hall, Bandung", "socialMedia": "@kyuufest / @bandunglautan.creator", "priceText": "Rp 15.000", "isFree": false },
            { "name": "Genshiken ITB", "date": "05/07/2025", "location": "Aula Timur ITB", "socialMedia": "@genshikenitb", "priceText": "TBA", "isFree": false },
            { "name": "Q-Anifest 2025", "date": "20/07/2025", "location": "Hotel Harris Festival City Link", "socialMedia": "@qtakasievent", "priceText": "Rp 50.000", "isFree": false },
            { "name": "Festival Axia: KomyuDoujin", "date": "TBA", "location": "TBA", "socialMedia": "@festival.axia", "priceText": "TBA", "isFree": false }
        ];
        
        let settings = {
            "title": "UPCOMING EVENT",
            "subtitle": "List on Bandung",
            "background": "deep-space",
            "footer": "Made by Wibu_Baleendah",
            "eventsPerPage": 9,
            "showTimestamp": true,
            "showUrl": false,
            "titleFontSize": "98",
            "posterSize": "1080x1920",
            "textColor": "#ffffff",
            "textEffect": "none",
            "customGradient": { "start": "#1f2937", "end": "#111827" }
        };

        const gradients = {
            'deep-space': 'linear-gradient(to bottom right, #1f2937, #111827)',
            'sunset': 'linear-gradient(to bottom right, #7b2cbf, #f97316)',
            'oceanic': 'linear-gradient(to bottom right, #0369a1, #10b981)',
            'minty': 'linear-gradient(to bottom right, #6ee7b7, #3b82f6)',
            'royal': 'linear-gradient(to bottom right, #7e22ce, #db2777)',
            'gotham': 'linear-gradient(to bottom right, #404040, #0a0a0a)'
        };
        
        // --- UTILITY FUNCTIONS ---
        function debounce(func, delay = CONFIG.DEBOUNCE_DELAY) {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }

        let statusTimeout;
        function showStatusMessage(message, isError = false) {
            clearTimeout(statusTimeout);
            statusMessage.textContent = message;
            statusMessage.style.color = isError ? '#f87171' : '#4ade80'; // red-400 or green-400
            statusMessage.classList.add('visible');
            statusTimeout = setTimeout(() => {
                statusMessage.classList.remove('visible');
            }, CONFIG.STATUS_MESSAGE_DURATION);
        }

        // --- MODAL FUNCTIONS ---
        function showAlert(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalButtons.innerHTML = `<button id="modal-ok" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500">OK</button>`;
            modal.classList.remove('hidden');
            setTimeout(() => modal.firstElementChild.classList.remove('scale-95'), 10);
            getEl('modal-ok').onclick = () => {
                 modal.firstElementChild.classList.add('scale-95');
                 setTimeout(() => modal.classList.add('hidden'), 300);
            };
        }

        function showConfirm(title, message, onConfirm) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalButtons.innerHTML = `
                <button id="modal-cancel" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-gray-500">Cancel</button>
                <button id="modal-confirm" class="px-6 py-2 bg-red-600 hover:bg-red-700 rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500">Confirm</button>
            `;
            modal.classList.remove('hidden');
            setTimeout(() => modal.firstElementChild.classList.remove('scale-95'), 10);
            const hideModal = () => {
                modal.firstElementChild.classList.add('scale-95');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
            getEl('modal-cancel').onclick = hideModal;
            getEl('modal-confirm').onclick = () => {
                hideModal();
                onConfirm();
            };
        }
        
        // --- DATA PERSISTENCE ---
        const saveState = () => {
            localStorage.setItem(CONFIG.LOCAL_STORAGE_KEY, JSON.stringify({ events, settings }));
            showStatusMessage('Changes saved!');
        };
        const debouncedSaveState = debounce(saveState);

        const loadState = () => {
            const storedState = localStorage.getItem(CONFIG.LOCAL_STORAGE_KEY);
            if (storedState) {
                try {
                    const loadedState = JSON.parse(storedState);
                    if (loadedState.events && loadedState.settings) {
                        events = loadedState.events;
                        settings = { ...settings, ...loadedState.settings };
                    }
                } catch(e) {
                    console.error("Could not parse state from localStorage", e);
                    localStorage.removeItem(CONFIG.LOCAL_STORAGE_KEY);
                }
            }
        };
        
        // --- DYNAMIC PREVIEW SIZING ---
        function updatePreviewSize() {
            if (!previewWrapper || !posterScaler) return;
            const [width, height] = settings.posterSize.split('x').map(Number);
            previewWrapper.style.aspectRatio = `${width} / ${height}`;
            const containerWidth = previewWrapper.offsetWidth;
            const scale = containerWidth / width;
            posterScaler.style.transform = `scale(${scale})`;
        }


        // --- RENDERING FUNCTIONS ---
        const createEventElement = (event, index, showActionButtons) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex items-center gap-4';

            const eventElement = document.createElement('div');
            eventElement.className = 'event-item py-4 border-b border-white/20 flex-grow';
            
            let priceColor;
            if (event.priceText === 'Free') priceColor = 'text-green-400';
            else if (event.priceText === 'TBA') priceColor = 'text-yellow-400';
            else priceColor = 'text-cyan-400';

            const actionButtonsHtml = showActionButtons 
                ? `
                <div class="action-buttons flex flex-col gap-2 z-30">
                    <button data-action="remove" data-index="${index}" title="Remove Event" class="text-gray-400 hover:text-red-500 transition-colors">
                        <svg class="w-8 h-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                ` : '';
            
            eventElement.innerHTML = `
                <div class="flex justify-between items-start gap-4">
                    <h3 class="text-5xl font-bold text-white break-words min-w-0" contenteditable="true" data-index="${index}" data-field="name">${event.name}</h3>
                    <p class="text-4xl font-bold ${priceColor} mt-1 flex-shrink-0 pl-4" contenteditable="true" data-index="${index}" data-field="priceText">${event.priceText}</p>
                </div>
                <div class="mt-4 text-3xl text-gray-300">
                    <div class="flex flex-wrap items-center gap-x-4">
                        <span contenteditable="true" data-index="${index}" data-field="date">${event.date}</span>
                        <span class="text-gray-500">|</span>
                        <span contenteditable="true" data-index="${index}" data-field="location">${event.location}</span>
                        ${event.socialMedia ? `<span class="text-gray-500">|</span><span contenteditable="true" data-index="${index}" data-field="socialMedia">${event.socialMedia}</span>` : ''}
                    </div>
                </div>
            `;

            wrapper.appendChild(eventElement);
            if(showActionButtons) {
                 const buttonsDiv = document.createElement('div');
                 buttonsDiv.innerHTML = actionButtonsHtml;
                 wrapper.appendChild(buttonsDiv);
            }

            return wrapper;
        };

        const renderEventsInPreview = () => {
            previewListContainer.innerHTML = '';
            
            if (events.length === 0) {
                previewListContainer.innerHTML = `<div class="p-8 text-center text-gray-500"><h3 class="text-4xl font-bold">No events yet.</h3><p class="text-3xl mt-2">Use the form to add one!</p></div>`;
                return;
            }
            events.forEach((event, index) => {
                const eventElement = createEventElement(event, index, true);
                previewListContainer.appendChild(eventElement);
            });
        };

        function updateFormControls() {
            posterSizeSelect.value = settings.posterSize;
            posterTitleInput.value = settings.title;
            posterSubtitleInput.value = settings.subtitle;
            posterBackgroundSelect.value = settings.background;
            posterFooterInput.value = settings.footer;
            eventsPerPageInput.value = settings.eventsPerPage;
            showTimestampCheckbox.checked = settings.showTimestamp;
            showUrlCheckbox.checked = settings.showUrl;
            titleFontSizeSlider.value = settings.titleFontSize;
            fontSizeValueSpan.textContent = settings.titleFontSize;
            textColorInput.value = settings.textColor;
            textEffectSelect.value = settings.textEffect;
            gradientStartColorInput.value = settings.customGradient.start;
            gradientEndColorInput.value = settings.customGradient.end;
        }
        
        function updateDynamicRecommendations() {
             if (settings.posterSize === '1080x1350') {
                eventsPerPageRecommendation.textContent = 'Recommended: 5 for 4:5 size.';
                fontSizeRecommendation.textContent = 'Recommended: 98px for 4:5 size.';
            } else {
                eventsPerPageRecommendation.textContent = 'Recommended: 9 for Story size.';
                fontSizeRecommendation.textContent = ''; // No recommendation for story size
            }
        }

        function updatePreviewStyles() {
            // Update size-related classes
            if (settings.posterSize === '1080x1350') {
                posterContent.classList.remove('size-story');
                posterContent.classList.add('size-post');
            } else {
                posterContent.classList.remove('size-post');
                posterContent.classList.add('size-story');
            }
            updatePreviewSize();
            updateDynamicRecommendations();

            // Update text and other styles
            previewTitle.style.fontSize = `${settings.titleFontSize}px`;
            previewTitle.textContent = settings.title;
            previewSubtitle.textContent = settings.subtitle;
            posterContent.style.color = settings.textColor;
            
            // Handle text effects
            posterContent.classList.remove('text-effect-shadow', 'text-effect-glow');
            if(settings.textEffect !== 'none') {
                posterContent.classList.add(`text-effect-${settings.textEffect}`);
            }
            
            if(settings.background === 'custom') {
                posterBackgroundOverlay.style.backgroundImage = `linear-gradient(to bottom right, ${settings.customGradient.start}, ${settings.customGradient.end})`;
                customGradientControls.classList.remove('hidden');
            } else {
                posterBackgroundOverlay.style.backgroundImage = gradients[settings.background];
                customGradientControls.classList.add('hidden');
            }
            
            previewFooter.textContent = settings.footer;
            previewTimestamp.style.display = 'none';
            previewUrl.style.display = 'none';
        }

        // --- EVENT HANDLERS & LOGIC ---
        function formatPrice(price) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(price);
        }
        
        const parseDate = (dateStr) => {
            if (dateStr.toUpperCase() === 'TBA') return null; // Handle TBA dates
            const [day, month, year] = dateStr.split('/');
            return new Date(year, month - 1, day);
        };
        
        const sortEvents = () => {
            events.sort((a, b) => {
                const dateA = parseDate(a.date);
                const dateB = parseDate(b.date);

                if (dateA === null && dateB === null) return 0; // Both are TBA
                if (dateA === null) return 1; // a is TBA, put it last
                if (dateB === null) return -1; // b is TBA, put it last

                return dateA - dateB;
            });
        };

        async function addEvent(e) {
            e.preventDefault();
            
            let priceText;
            if (isFreeCheckbox.checked) {
                priceText = 'Free';
            } else if (isTbaCheckbox.checked) {
                priceText = 'TBA';
            } else {
                 const priceValueStr = eventPriceInput.value.trim();
                 priceText = priceValueStr === '' ? 'TBA' : formatPrice(parseFloat(priceValueStr));
            }

            const newEvent = {
                name: eventNameInput.value,
                date: isDateTbaCheckbox.checked ? 'TBA' : eventDateInput.value,
                location: eventLocationInput.value,
                socialMedia: eventSocialInput.value,
                priceText: priceText,
                isFree: isFreeCheckbox.checked
            };

            events.push(newEvent);
            sortEvents();
            saveState();
            renderEventsInPreview();
            eventForm.reset();
            togglePriceInput();
            toggleDateInput();
        }

        function handleListInteraction(e) {
            const button = e.target.closest('button[data-action]');
            if (!button) return;

            const action = button.dataset.action;
            const index = parseInt(button.dataset.index, 10);

            if (action === 'remove') {
                events.splice(index, 1);
                saveState();
                renderEventsInPreview();
            }
        }
        
        function clearAllEvents() {
            if (events.length === 0) return;
            showConfirm('Clear All Events', 'Are you sure you want to delete all events? This action cannot be undone.', () => {
                events = [];
                saveState();
                renderEventsInPreview();
            });
        }

        function togglePriceInput(initiator = null) {
            if (initiator === 'free' && isFreeCheckbox.checked) {
                isTbaCheckbox.checked = false;
                eventPriceInput.disabled = true;
                eventPriceInput.value = '';
            } else if (initiator === 'tba' && isTbaCheckbox.checked) {
                 isFreeCheckbox.checked = false;
                 eventPriceInput.disabled = true;
                 eventPriceInput.value = '';
            } else if (initiator === 'input') {
                 isFreeCheckbox.checked = false;
                 isTbaCheckbox.checked = false;
                 eventPriceInput.disabled = false;
            } else if (!isFreeCheckbox.checked && !isTbaCheckbox.checked){
                 eventPriceInput.disabled = false;
            }
        }

        function toggleDateInput() {
            if (isDateTbaCheckbox.checked) {
                eventDateInput.disabled = true;
                eventDateInput.value = "TBA";
                if(datepickerInstance) datepickerInstance.hide();
            } else {
                eventDateInput.disabled = false;
                eventDateInput.value = "";
            }
        }
        
        function exportData() {
            if (events.length === 0) {
                 showAlert('Cannot Export', 'There are no events to export. Please add at least one event.');
                 return;
            }
            const dataStr = JSON.stringify({ events, settings }, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.download = `event-poster-data-${new Date().toISOString().slice(0,10)}.json`;
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedState = JSON.parse(e.target.result);
                    if (importedState && importedState.events && importedState.settings) {
                        events = importedState.events;
                        settings = { ...settings, ...importedState.settings };
                        updateFormControls();
                        updatePreviewStyles();
                        renderEventsInPreview();
                        saveState();
                        showStatusMessage('Data imported successfully!');
                    } else {
                        showAlert('Import Error', 'Invalid data file format.');
                    }
                } catch (error) {
                    console.error("Error parsing imported file:", error);
                    showAlert('Import Error', 'Could not read or parse the selected file.');
                }
            };
            reader.readAsText(file);
            importInput.value = '';
        }
        
        // --- Direct Canvas Edit Handlers ---
        const settingToInputMap = {
            title: posterTitleInput,
            subtitle: posterSubtitleInput,
            footer: posterFooterInput
        };

        function handleDirectEdit(e) {
            const element = e.target;
            if (!element || !element.isContentEditable) return;
            const key = element.dataset.setting;
            
            if (key) {
                const newValue = element.textContent.trim();
                if (settings[key] !== newValue) {
                    settings[key] = newValue;
                    settingToInputMap[key].value = newValue;
                    debouncedSaveState();
                }
            } else if (element.dataset.field) {
                 const index = parseInt(element.dataset.index, 10);
                 const field = element.dataset.field;
                 const newValue = element.textContent.trim();
                 
                 if (!events[index]) return;

                 if (field === 'priceText') {
                     const upperCaseValue = newValue.toUpperCase();
                     let newPriceText;
                     if (upperCaseValue === 'FREE') {
                         newPriceText = 'Free';
                         events[index].isFree = true;
                     } else if (upperCaseValue === 'TBA') {
                         newPriceText = 'TBA';
                         events[index].isFree = false;
                     } else {
                         const numericValue = parseFloat(newValue.replace(/[^0-9]/g, ''));
                         if (!isNaN(numericValue)) {
                             newPriceText = formatPrice(numericValue);
                             events[index].isFree = false;
                         } else {
                             newPriceText = 'TBA';
                             events[index].isFree = false;
                         }
                     }
                     
                     if (events[index].priceText !== newPriceText) {
                        events[index].priceText = newPriceText;
                        debouncedSaveState();
                        renderEventsInPreview(); 
                     }
                 } else if (field === 'date') {
                    if (events[index][field] !== newValue) {
                        events[index][field] = newValue;
                        debouncedSaveState();
                        sortEvents();
                        renderEventsInPreview();
                    }
                 }
                 else {
                     if (events[index][field] !== newValue) {
                        events[index][field] = newValue;
                        debouncedSaveState();
                     }
                 }
            }
        }
        
        function preventLineBreaks(e) {
            if (e.target.isContentEditable && e.key === 'Enter') {
                e.preventDefault();
                e.target.blur();
            }
        }

        async function downloadImage() {
            if (events.length === 0) {
                showAlert('Cannot Download', "Please add at least one event before downloading.");
                return;
            }
            
            loadingIndicator.classList.remove('hidden');
            downloadBtn.disabled = true;
            downloadBtn.classList.add('opacity-50', 'cursor-not-allowed');

            const delay = ms => new Promise(res => setTimeout(res, ms));
            const [width, height] = settings.posterSize.split('x').map(Number);
            
            const eventsPerPage = parseInt(eventsPerPageInput.value, 10) || 9;
            const totalPages = Math.ceil(events.length / eventsPerPage);

            for (let i = 0; i < totalPages; i++) {
                const page = i + 1;
                loadingIndicator.textContent = `Generating image ${page} of ${totalPages}...`;
                const chunk = events.slice(i * eventsPerPage, (i + 1) * eventsPerPage);

                const posterClone = posterContent.cloneNode(true);
                posterClone.querySelectorAll('[contenteditable="true"]').forEach(el => el.setAttribute('contenteditable', 'false'));

                // Apply size class to the clone for correct styling
                if (settings.posterSize === '1080x1350') {
                    posterClone.classList.remove('size-story');
                    posterClone.classList.add('size-post');
                } else {
                    posterClone.classList.remove('size-post');
                    posterClone.classList.add('size-story');
                }

                const listInClone = posterClone.querySelector('.event-list-container');
                listInClone.innerHTML = '';

                chunk.forEach((event, index) => {
                    const eventElement = createEventElement(event, index, false);
                    listInClone.appendChild(eventElement);
                });

                const timestampEl = posterClone.querySelector('#preview-timestamp');
                if (settings.showTimestamp) {
                    timestampEl.textContent = `Generated on: ${new Date().toLocaleString()}`;
                    timestampEl.style.display = 'block';
                } else {
                    timestampEl.style.display = 'none';
                }
                
                const urlEl = posterClone.querySelector('#preview-url');
                if (settings.showUrl) {
                    urlEl.textContent = window.location.href;
                    urlEl.style.display = 'block';
                } else {
                    urlEl.style.display = 'none';
                }

                posterClone.querySelector('#preview-footer').textContent = settings.footer;


                posterClone.style.position = 'absolute';
                posterClone.style.top = '-9999px';
                posterClone.style.left = '0px';
                posterClone.style.zIndex = '-100';
                document.body.appendChild(posterClone);
                
                try {
                    await delay(200);

                    const canvas = await html2canvas(posterClone, {
                        scale: 1, 
                        useCORS: true,
                        logging: false,
                        backgroundColor: null, 
                        width: width,
                        height: height,
                        windowWidth: width,
                        windowHeight: height
                    });

                    const link = document.createElement('a');
                    link.download = `event-poster-${page}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    link.remove();
                    await delay(500);
                } catch (err) {
                    console.error('Oops, something went wrong!', err);
                    showAlert('Image Generation Failed', `An error occurred while creating image ${page}. Please try again.`);
                    break;
                } finally {
                    document.body.removeChild(posterClone);
                }
            }

            loadingIndicator.classList.add('hidden');
            loadingIndicator.textContent = `Generating image... please wait.`;
            downloadBtn.disabled = false;
            downloadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        
        // --- EVENT LISTENERS ---
        function attachListeners() {
            // Initial Setup on Load
            datepickerInstance = new Datepicker(eventDateInput, {
                format: 'dd/mm/yyyy',
                autohide: true,
                buttonClass: 'btn'
            }); 
            
            loadState();
            updateFormControls();
            updatePreviewStyles();
            renderEventsInPreview();
        
            window.addEventListener('resize', updatePreviewSize); 

            const debouncedUpdateStyles = debounce(updatePreviewStyles);

            // Customization listeners (from form inputs)
            posterSizeSelect.addEventListener('change', e => { 
                settings.posterSize = e.target.value;
                if (settings.posterSize === '1080x1350') {
                    settings.eventsPerPage = 5;
                } else {
                    settings.eventsPerPage = 9;
                }
                updateFormControls();
                updatePreviewStyles(); 
                saveState();
            });
            posterTitleInput.addEventListener('input', e => { settings.title = e.target.value; previewTitle.textContent = e.target.value; debouncedSaveState(); });
            posterSubtitleInput.addEventListener('input', e => { settings.subtitle = e.target.value; previewSubtitle.textContent = e.target.value; debouncedSaveState(); });
            posterBackgroundSelect.addEventListener('change', e => { settings.background = e.target.value; updatePreviewStyles(); saveState(); });
            posterFooterInput.addEventListener('input', e => { settings.footer = e.target.value; previewFooter.textContent = e.target.value; debouncedSaveState(); });
            eventsPerPageInput.addEventListener('change', e => { settings.eventsPerPage = parseInt(e.target.value, 10); saveState(); });
            showTimestampCheckbox.addEventListener('change', e => { settings.showTimestamp = e.target.checked; saveState(); });
            showUrlCheckbox.addEventListener('change', e => { settings.showUrl = e.target.checked; saveState(); });
            titleFontSizeSlider.addEventListener('input', e => { settings.titleFontSize = e.target.value; fontSizeValueSpan.textContent = e.target.value; previewTitle.style.fontSize = `${e.target.value}px`; debouncedSaveState(); });
            gradientStartColorInput.addEventListener('input', e => { settings.customGradient.start = e.target.value; debouncedUpdateStyles(); debouncedSaveState(); });
            gradientEndColorInput.addEventListener('input', e => { settings.customGradient.end = e.target.value; debouncedUpdateStyles(); debouncedSaveState(); });
            textColorInput.addEventListener('input', e => { settings.textColor = e.target.value; updatePreviewStyles(); debouncedSaveState(); });
            textEffectSelect.addEventListener('change', e => { settings.textEffect = e.target.value; updatePreviewStyles(); saveState(); });

            // Direct editing listeners
            posterContent.addEventListener('focusout', handleDirectEdit);
            posterContent.addEventListener('keydown', preventLineBreaks);

            // Other event listeners
            eventForm.addEventListener('submit', addEvent);
            isFreeCheckbox.addEventListener('change', () => togglePriceInput('free'));
            isTbaCheckbox.addEventListener('change', () => togglePriceInput('tba'));
            eventPriceInput.addEventListener('input', () => togglePriceInput('input'));
            isDateTbaCheckbox.addEventListener('change', toggleDateInput);

            downloadBtn.addEventListener('click', downloadImage);
            clearBtn.addEventListener('click', clearAllEvents);
            sortBtn.addEventListener('click', () => {
                sortEvents();
                saveState();
                renderEventsInPreview();
            });
            previewListContainer.addEventListener('click', handleListInteraction);
            exportBtn.addEventListener('click', exportData);
            importBtn.addEventListener('click', () => importInput.click());
            importInput.addEventListener('change', importData);
        }

        document.addEventListener('DOMContentLoaded', attachListeners);

    })();
    </script>
</body>
</html>
