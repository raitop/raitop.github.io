<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Poster Generator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas library for converting HTML to image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- VanillaJS Datepicker for calendar input -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/css/datepicker-bs5.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/js/datepicker-full.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Apply the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* The container that will be captured */
        #poster-content {
            width: 1080px;
            height: 1920px;
            background-size: cover;
            background-position: center;
        }

        /* Styling for the scrollbar for better aesthetics and readability */
        .event-list-container::-webkit-scrollbar {
            width: 12px;
        }
        .event-list-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .event-list-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 3px solid transparent;
            background-clip: content-box;
        }
        .event-list-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        /* Hide action buttons during canvas generation */
        .html2canvas-container .action-buttons {
            display: none;
        }
        /* Custom styles for the datepicker */
        .datepicker-picker {
            background-color: #374151; /* gray-700 */
            border-radius: 1rem;
            border: 1px solid #4b5563; /* gray-600 */
        }
        .datepicker-picker span {
             color: #d1d5db; /* gray-300 */
        }
        .datepicker-picker .datepicker-cell:not(.disabled):hover {
            background-color: #4b5563; /* gray-600 */
        }
        .datepicker-picker .datepicker-cell.selected, .datepicker-picker .datepicker-cell.selected:hover {
             background-color: #4f46e5; /* indigo-600 */
             color: #fff;
        }
        .datepicker-picker .datepicker-cell.focused:not(.selected) {
            background-color: #374151;
            border: 1px solid #6366f1;
        }
         .datepicker-picker .datepicker-cell.today:not(.selected){
            background-color: #374151;
            border: 1px solid #9ca3af;
        }
        .action-buttons button:disabled {
            opacity: 0.2;
            cursor: not-allowed;
        }

    </style>
</head>
<body class="bg-gray-800 text-white">

    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold tracking-tight">Social Media Event Poster Generator</h1>
            <p class="text-gray-400 mt-2">Add events and download your poster. Your list is saved in your browser.</p>
        </header>
        
        <input type="file" id="import-input" class="hidden" accept=".json">


        <div class="flex flex-col lg:grid lg:grid-cols-3 lg:gap-8">

            <!-- Left Column: Event Details Form -->
            <div class="lg:col-span-1 bg-gray-900 p-6 rounded-2xl shadow-lg">
                 <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Event Details</h2>
                <form id="event-form" class="space-y-4">
                    <div>
                        <label for="event-name" class="block text-sm font-medium text-gray-300">Event Name</label>
                        <input type="text" id="event-name" name="event-name" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="event-date" class="block text-sm font-medium text-gray-300">Date</label>
                        <input type="text" id="event-date" name="event-date" placeholder="Select a date" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2" autocomplete="off">
                    </div>
                    <div>
                        <label for="event-location" class="block text-sm font-medium text-gray-300">Location</label>
                        <input type="text" id="event-location" name="event-location" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                     <div>
                        <label for="event-social" class="block text-sm font-medium text-gray-300">Social Media Handle</label>
                        <input type="text" id="event-social" name="event-social" placeholder="@username" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="event-price" class="block text-sm font-medium text-gray-300">Ticket Price (IDR)</label>
                        <div class="flex items-center space-x-4 mt-1">
                            <input type="number" id="event-price" name="event-price" placeholder="50000" class="block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                             <div class="flex items-center">
                                <input id="is-free" name="is-free" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-600 rounded bg-gray-700">
                                <label for="is-free" class="ml-2 block text-sm text-gray-300">Free</label>
                            </div>
                             <div class="flex items-center">
                                <input id="is-tba" name="is-tba" type="checkbox" class="h-4 w-4 text-yellow-500 focus:ring-yellow-400 border-gray-600 rounded bg-gray-700">
                                <label for="is-tba" class="ml-2 block text-sm text-gray-300">TBA</label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md">
                        Add Event to List
                    </button>
                </form>
            </div>

            <!-- Middle Column: Poster Preview -->
            <div class="lg:col-span-1 flex-1 flex flex-col items-center">
                <h2 class="text-2xl font-bold mb-4 text-center">Poster Preview</h2>
                <!-- Container for the scaled preview. It sets the size and clips. -->
                <div id="preview-wrapper" class="w-full max-w-[360px] md:max-w-[450px] shadow-2xl rounded-xl overflow-hidden bg-gray-900" style="aspect-ratio: 1080 / 1920;">
                    <!-- This div is scaled by JavaScript to fit the container above -->
                    <div id="poster-scaler" class="origin-top-left">
                        <!-- The actual poster content that will be rendered -->
                        <div id="poster-content" class="text-white flex flex-col p-24 relative overflow-hidden">
                            <div id="poster-background-overlay" class="absolute inset-0 z-0"></div>
                            <header class="text-center relative z-10">
                                <h1 id="preview-title" class="font-black tracking-tighter uppercase"></h1>
                                <p id="preview-subtitle" class="text-5xl text-gray-400 mt-2"></p>
                            </header>
                            <!-- Using class instead of ID for safer cloning -->
                            <main class="event-list-container flex-grow overflow-y-auto py-12 -mx-4 px-4 relative z-10">
                                <!-- Events will be dynamically inserted here -->
                            </main>
                            <div class="mt-auto pt-4 relative z-10">
                                <p id="preview-timestamp" class="text-center text-gray-500 text-xl mb-2"></p>
                                <footer id="preview-footer" class="text-center text-gray-500 text-2xl"></footer>
                                <p id="preview-url" class="text-center text-gray-600 text-lg mt-1"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Other Controls -->
            <div class="lg:col-span-1 bg-gray-900 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Poster Customization</h2>
                <div class="space-y-4">
                    <div>
                        <label for="poster-title" class="block text-sm font-medium text-gray-300">Title</label>
                        <input type="text" id="poster-title" name="poster-title" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="title-font-size" class="block text-sm font-medium text-gray-300">Title Font Size: <span id="font-size-value">144</span>px</label>
                        <input type="range" id="title-font-size" min="80" max="200" value="144" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div>
                        <label for="poster-subtitle" class="block text-sm font-medium text-gray-300">Subtitle</label>
                        <input type="text" id="poster-subtitle" name="poster-subtitle" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                    <div>
                        <label for="poster-background" class="block text-sm font-medium text-gray-300">Background Preset</label>
                        <select id="poster-background" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                            <option value="deep-space">Deep Space (Default)</option>
                            <option value="sunset">Sunset</option>
                            <option value="oceanic">Oceanic</option>
                            <option value="minty">Minty</option>
                            <option value="royal">Royal</option>
                            <option value="gotham">Gotham</option>
                            <option value="custom">Custom Gradient</option>
                        </select>
                    </div>
                    <div id="custom-gradient-controls" class="hidden space-y-2">
                        <div class="flex items-center gap-4">
                            <label for="gradient-start-color" class="text-sm font-medium text-gray-300">Start</label>
                            <input type="color" id="gradient-start-color" class="p-1 h-10 w-full block bg-gray-700 border-gray-600 cursor-pointer rounded-lg disabled:opacity-50 disabled:pointer-events-none">
                        </div>
                        <div class="flex items-center gap-4">
                            <label for="gradient-end-color" class="text-sm font-medium text-gray-300">End</label>
                             <input type="color" id="gradient-end-color" class="p-1 h-10 w-full block bg-gray-700 border-gray-600 cursor-pointer rounded-lg disabled:opacity-50 disabled:pointer-events-none">
                        </div>
                    </div>
                     <div>
                        <label for="poster-footer" class="block text-sm font-medium text-gray-300">Footer Text</label>
                        <input type="text" id="poster-footer" name="poster-footer" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                    </div>
                     <div>
                        <label for="events-per-page" class="block text-sm font-medium text-gray-300">Events Per Image</label>
                        <input type="number" id="events-per-page" name="events-per-page" value="9" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-white p-2">
                        <p class="text-xs text-gray-500 mt-1">Recommended: 5-9 events per image.</p>
                    </div>
                    <div class="flex items-center">
                        <input id="show-timestamp" name="show-timestamp" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-600 rounded bg-gray-700">
                        <label for="show-timestamp" class="ml-2 block text-sm text-gray-300">Show Generation Timestamp</label>
                    </div>
                     <div class="flex items-center">
                        <input id="show-url" name="show-url" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-600 rounded bg-gray-700">
                        <label for="show-url" class="ml-2 block text-sm text-gray-300">Show Page URL</label>
                    </div>
                </div>

                <!-- List Management Controls -->
                <div class="mt-8">
                     <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">List Management</h2>
                     <div class="space-y-2">
                         <button id="sort-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            <span>Sort by Date</span>
                        </button>
                        <button id="populate-btn" class="w-full bg-yellow-600 hover:bg-yellow-700 text-black font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" /></svg>
                            <span>Populate with Test Data</span>
                        </button>
                        <button id="export-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                            <span>Export Data</span>
                        </button>
                         <button id="import-btn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l4 4m0 0l-4 4m4-4H4" /></svg>
                            <span>Import Data</span>
                        </button>
                        <button id="clear-btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            <span>Clear All Events</span>
                        </button>
                    </div>
                </div>

                <!-- Download Controls -->
                <div class="mt-8">
                     <h2 class="text-2xl font-bold mb-4 border-b border-gray-700 pb-2">Download</h2>
                     <button id="download-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        <span>Generate & Download Image</span>
                    </button>
                    <div id="loading-indicator" class="hidden text-center mt-4 text-yellow-400">Generating image... please wait.</div>
                </div>
            </div>

        </div>
    </div>
    
    <!-- Custom Modal -->
    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex justify-center items-center p-4 transition-opacity duration-300">
        <div class="bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md text-center transform scale-95 transition-transform duration-300">
            <h3 id="modal-title" class="text-xl font-bold mb-4">Modal Title</h3>
            <p id="modal-message" class="text-gray-300 mb-6">Modal message goes here.</p>
            <div id="modal-buttons" class="flex justify-center space-x-4">
                <!-- Buttons will be injected here by JS -->
            </div>
        </div>
    </div>


    <script>
        // --- FORM & CONTROL DOM REFERENCES ---
        const eventForm = document.getElementById('event-form');
        const eventNameInput = document.getElementById('event-name');
        const eventDateInput = document.getElementById('event-date');
        const eventLocationInput = document.getElementById('event-location');
        const eventSocialInput = document.getElementById('event-social');
        const eventPriceInput = document.getElementById('event-price');
        const isFreeCheckbox = document.getElementById('is-free');
        const isTbaCheckbox = document.getElementById('is-tba');
        
        const posterTitleInput = document.getElementById('poster-title');
        const posterSubtitleInput = document.getElementById('poster-subtitle');
        const posterBackgroundSelect = document.getElementById('poster-background');
        const posterFooterInput = document.getElementById('poster-footer');
        const eventsPerPageInput = document.getElementById('events-per-page');
        const showTimestampCheckbox = document.getElementById('show-timestamp');
        const showUrlCheckbox = document.getElementById('show-url');
        const titleFontSizeSlider = document.getElementById('title-font-size');
        const fontSizeValueSpan = document.getElementById('font-size-value');
        const customGradientControls = document.getElementById('custom-gradient-controls');
        const gradientStartColorInput = document.getElementById('gradient-start-color');
        const gradientEndColorInput = document.getElementById('gradient-end-color');
        
        const downloadBtn = document.getElementById('download-btn');
        const clearBtn = document.getElementById('clear-btn');
        const populateBtn = document.getElementById('populate-btn');
        const sortBtn = document.getElementById('sort-btn');
        const exportBtn = document.getElementById('export-btn');
        const importBtn = document.getElementById('import-btn');
        const importInput = document.getElementById('import-input');
        const loadingIndicator = document.getElementById('loading-indicator');

        // --- PREVIEW DOM REFERENCES ---
        const previewWrapper = document.getElementById('preview-wrapper');
        const posterScaler = document.getElementById('poster-scaler');
        const posterContent = document.getElementById('poster-content');
        const posterBackgroundOverlay = document.getElementById('poster-background-overlay');
        const previewTitle = document.getElementById('preview-title');
        const previewSubtitle = document.getElementById('preview-subtitle');
        const previewListContainer = document.querySelector('#poster-content .event-list-container');
        const previewTimestamp = document.getElementById('preview-timestamp');
        const previewFooter = document.getElementById('preview-footer');
        const previewUrl = document.getElementById('preview-url');

        // --- MODAL DOM REFERENCES ---
        const modal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalButtons = document.getElementById('modal-buttons');

        // --- DATA STATE ---
        let events = [];
        let settings = {
            title: 'Upcoming Events',
            subtitle: "Don't Miss Out!",
            background: 'deep-space',
            footer: 'Generated with Event Poster Maker',
            eventsPerPage: 9,
            showTimestamp: false,
            showUrl: false,
            titleFontSize: 144, // 9xl in px
            customGradient: { start: '#1f2937', end: '#111827' }
        };
        const gradients = {
            'deep-space': 'linear-gradient(to bottom right, #1f2937, #111827)',
            'sunset': 'linear-gradient(to bottom right, #7b2cbf, #f97316)',
            'oceanic': 'linear-gradient(to bottom right, #0369a1, #10b981)',
            'minty': 'linear-gradient(to bottom right, #6ee7b7, #3b82f6)',
            'royal': 'linear-gradient(to bottom right, #7e22ce, #db2777)',
            'gotham': 'linear-gradient(to bottom right, #404040, #0a0a0a)'
        };

        // --- MODAL FUNCTIONS ---
        function showAlert(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalButtons.innerHTML = `<button id="modal-ok" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500">OK</button>`;
            modal.classList.remove('hidden');
            setTimeout(() => modal.firstElementChild.classList.remove('scale-95'), 10);
            document.getElementById('modal-ok').onclick = () => {
                 modal.firstElementChild.classList.add('scale-95');
                 setTimeout(() => modal.classList.add('hidden'), 300);
            };
        }

        function showConfirm(title, message, onConfirm) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalButtons.innerHTML = `
                <button id="modal-cancel" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-gray-500">Cancel</button>
                <button id="modal-confirm" class="px-6 py-2 bg-red-600 hover:bg-red-700 rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500">Confirm</button>
            `;
            modal.classList.remove('hidden');
            setTimeout(() => modal.firstElementChild.classList.remove('scale-95'), 10);
            const hideModal = () => {
                modal.firstElementChild.classList.add('scale-95');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
            document.getElementById('modal-cancel').onclick = hideModal;
            document.getElementById('modal-confirm').onclick = () => {
                hideModal();
                onConfirm();
            };
        }
        
        // --- DATA PERSISTENCE ---
        const saveState = () => {
            localStorage.setItem('posterGeneratorState', JSON.stringify({ events, settings }));
        };

        const loadState = () => {
            const storedState = localStorage.getItem('posterGeneratorState');
            if (storedState) {
                try {
                    const loadedState = JSON.parse(storedState);
                    events = loadedState.events || [];
                    settings = { ...settings, ...loadedState.settings };
                } catch(e) {
                    console.error("Could not parse state from localStorage", e);
                    localStorage.removeItem('posterGeneratorState');
                }
            }
        };
        
        // --- DYNAMIC PREVIEW SIZING ---
        function updatePreviewSize() {
            if (!previewWrapper || !posterScaler) return;
            const containerWidth = previewWrapper.offsetWidth;
            const scale = containerWidth / 1080; // 1080 is the poster's native width
            posterScaler.style.transform = `scale(${scale})`;
        }


        // --- RENDERING FUNCTIONS ---
        const createEventElement = (event, index, showActionButtons) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'flex items-center gap-4';

            const eventElement = document.createElement('div');
            eventElement.className = 'event-item py-4 border-b border-white/20 flex-grow';
            
            let priceColor;
            if (event.priceText === 'Free') {
                priceColor = 'text-green-400';
            } else if (event.priceText === 'TBA') {
                priceColor = 'text-yellow-400';
            } else {
                priceColor = 'text-cyan-400';
            }

            const actionButtonsHtml = showActionButtons 
                ? `
                <div class="action-buttons flex flex-col gap-2 z-30">
                    <button data-action="remove" data-index="${index}" title="Remove Event" class="text-gray-400 hover:text-red-500 transition-colors">
                        <svg class="w-8 h-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                `
                : '';
            
            eventElement.innerHTML = `
                <div class="flex justify-between items-start gap-4">
                    <h3 class="text-5xl font-bold text-white break-words min-w-0">${event.name}</h3>
                    <p class="text-4xl font-bold ${priceColor} mt-1 flex-shrink-0 pl-4">${event.priceText}</p>
                </div>
                <div class="mt-4 text-3xl text-gray-300">
                    <div class="flex flex-wrap items-center gap-x-4">
                        <span>${event.date}</span>
                        <span class="text-gray-500">|</span>
                        <span>${event.location}</span>
                        ${event.socialMedia ? `<span class="text-gray-500">|</span><span>${event.socialMedia}</span>` : ''}
                    </div>
                </div>
            `;

            wrapper.appendChild(eventElement);
            if(showActionButtons) {
                 const buttonsDiv = document.createElement('div');
                 buttonsDiv.innerHTML = actionButtonsHtml;
                 wrapper.appendChild(buttonsDiv);
            }

            return wrapper;
        };

        const renderEventsInPreview = () => {
            previewListContainer.innerHTML = '';
            
            if (events.length === 0) {
                previewListContainer.innerHTML = `<div class="p-8 text-center text-gray-500"><h3 class="text-4xl font-bold">No events yet.</h3><p class="text-3xl mt-2">Use the form to add one!</p></div>`;
                return;
            }
            events.forEach((event, index) => {
                const eventElement = createEventElement(event, index, true);
                previewListContainer.appendChild(eventElement);
            });
        };

        const renderCustomizations = () => {
            posterTitleInput.value = settings.title;
            posterSubtitleInput.value = settings.subtitle;
            posterBackgroundSelect.value = settings.background;
            posterFooterInput.value = settings.footer;
            eventsPerPageInput.value = settings.eventsPerPage;
            showTimestampCheckbox.checked = settings.showTimestamp;
            showUrlCheckbox.checked = settings.showUrl;
            titleFontSizeSlider.value = settings.titleFontSize;
            fontSizeValueSpan.textContent = settings.titleFontSize;
            gradientStartColorInput.value = settings.customGradient.start;
            gradientEndColorInput.value = settings.customGradient.end;

            previewTitle.style.fontSize = `${settings.titleFontSize}px`;
            previewTitle.textContent = settings.title;
            previewSubtitle.textContent = settings.subtitle;
            
            // Background Image & Gradient Logic
            if(settings.background === 'custom') {
                posterBackgroundOverlay.style.backgroundImage = `linear-gradient(to bottom right, ${settings.customGradient.start}, ${settings.customGradient.end})`;
                customGradientControls.classList.remove('hidden');
            } else {
                posterBackgroundOverlay.style.backgroundImage = gradients[settings.background];
                customGradientControls.classList.add('hidden');
            }
            
            previewFooter.textContent = settings.footer;
            previewTimestamp.style.display = 'none';
            previewUrl.style.display = 'none';
        };

        // --- EVENT HANDLERS & LOGIC ---
        function formatPrice(price) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(price);
        }
        
        const parseDate = (dateStr) => {
            const [day, month, year] = dateStr.split('/');
            return new Date(year, month - 1, day);
        };
        
        const sortEvents = () => {
            events.sort((a, b) => {
                const dateA = parseDate(a.date);
                const dateB = parseDate(b.date);
                return dateA - dateB;
            });
        };

        async function addEvent(e) {
            e.preventDefault();
            
            let priceText;
            if (isFreeCheckbox.checked) {
                priceText = 'Free';
            } else if (isTbaCheckbox.checked) {
                priceText = 'TBA';
            } else {
                 const priceValueStr = eventPriceInput.value.trim();
                 priceText = priceValueStr === '' ? 'TBA' : formatPrice(parseFloat(priceValueStr));
            }
            
            const newEvent = {
                name: eventNameInput.value,
                date: eventDateInput.value,
                location: eventLocationInput.value,
                socialMedia: eventSocialInput.value,
                priceText: priceText,
                isFree: isFreeCheckbox.checked // Retained for potential future use
            };

            events.push(newEvent);
            sortEvents();
            saveState();
            renderEventsInPreview();
            eventForm.reset();
            togglePriceInput();
        }

        function handleListInteraction(e) {
            const button = e.target.closest('button[data-action]');
            if (!button) return;

            const action = button.dataset.action;
            const index = parseInt(button.dataset.index, 10);

            if (action === 'remove') {
                events.splice(index, 1);
                saveState();
                renderEventsInPreview();
            }
        }
        
        function clearAllEvents() {
            if (events.length === 0) return;
            showConfirm('Clear All Events', 'Are you sure you want to delete all events? This action cannot be undone.', () => {
                events = [];
                saveState();
                renderEventsInPreview();
            });
        }

        function togglePriceInput(initiator = null) {
            if (initiator === 'free' && isFreeCheckbox.checked) {
                isTbaCheckbox.checked = false;
                eventPriceInput.disabled = true;
                eventPriceInput.value = '';
            } else if (initiator === 'tba' && isTbaCheckbox.checked) {
                 isFreeCheckbox.checked = false;
                 eventPriceInput.disabled = true;
                 eventPriceInput.value = '';
            } else if (initiator === 'input') {
                 isFreeCheckbox.checked = false;
                 isTbaCheckbox.checked = false;
                 eventPriceInput.disabled = false;
            } else if (!isFreeCheckbox.checked && !isTbaCheckbox.checked){
                 eventPriceInput.disabled = false;
            }
        }
        
        function populateWithTestData() {
            const sampleNames = ["Cosmic Jam Fest", "Sunset Groove Party", "Tech Innovators Summit", "Indie Film Showcase", "Gourmet Food Fair", "Digital Art Expo", "Synthwave Night", "Startup Pitch Battle", "Urban Garden Workshop", "Acoustic Lakeside Sessions"];
            const sampleLocations = ["Jakarta", "Bandung", "Surabaya", "Yogyakarta", "Bali", "Medan", "Semarang", "Makassar"];
            const sampleSocials = ["@cosmicfest", "@sunsetgroove", "@techsummit.id", "@indiecinema", "@foodiefair", "@digitalexpo", "@synthwave.night", "@startupbattle", "@urbangardeners", "@lakesidesound"];
            
            for (let i = 0; i < 10; i++) {
                const isEventFree = Math.random() < 0.4;
                const isTBA = !isEventFree && Math.random() < 0.2;
                const randomDate = new Date(Date.now() + Math.random() * 31536000000); // Random date in the next year

                let priceText;
                if(isEventFree) {
                    priceText = "Free";
                } else if (isTBA) {
                    priceText = "TBA";
                } else {
                    priceText = formatPrice(Math.floor(Math.random() * 450001) + 50000);
                }

                const newEvent = {
                    name: sampleNames[Math.floor(Math.random() * sampleNames.length)],
                    date: randomDate.toLocaleDateString('en-GB'),
                    location: sampleLocations[Math.floor(Math.random() * sampleLocations.length)],
                    socialMedia: sampleSocials[Math.floor(Math.random() * sampleSocials.length)],
                    priceText: priceText,
                    isFree: isEventFree
                };
                events.push(newEvent);
            }
            sortEvents();
            saveState();
            renderEventsInPreview();
        }

        function exportData() {
            // Check if there is anything to export
            if (events.length === 0) {
                 showAlert('Cannot Export', 'There are no events to export. Please add at least one event.');
                 return;
            }
        
            // Stringify the data with pretty-printing (2 spaces for indentation)
            const dataStr = JSON.stringify({ events, settings }, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);
            
            // Create a link element
            const link = document.createElement('a');
            link.download = `event-poster-data-${new Date().toISOString().slice(0,10)}.json`;
            link.href = url;
            
            // The link must be in the document to be clicked in some browsers
            document.body.appendChild(link);
            link.click();
            
            // Clean up by removing the link and revoking the object URL
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedState = JSON.parse(e.target.result);
                    if (importedState && importedState.events && importedState.settings) {
                        events = importedState.events;
                        settings = { ...settings, ...importedState.settings };
                        saveState();
                        renderCustomizations();
                        renderEventsInPreview();
                        showAlert('Success', 'Data imported successfully!');
                    } else {
                        showAlert('Import Error', 'Invalid data file format.');
                    }
                } catch (error) {
                    console.error("Error parsing imported file:", error);
                    showAlert('Import Error', 'Could not read or parse the selected file.');
                }
            };
            reader.readAsText(file);
            // Reset file input to allow re-importing same file
            importInput.value = '';
        }
        
        async function downloadImage() {
            if (events.length === 0) {
                showAlert('Cannot Download', "Please add at least one event before downloading.");
                return;
            }
            
            loadingIndicator.classList.remove('hidden');
            downloadBtn.disabled = true;
            downloadBtn.classList.add('opacity-50', 'cursor-not-allowed');

            const delay = ms => new Promise(res => setTimeout(res, ms));

            const eventsPerPage = parseInt(eventsPerPageInput.value, 10) || 9;
            const totalPages = Math.ceil(events.length / eventsPerPage);

            for (let i = 0; i < totalPages; i++) {
                const page = i + 1;
                loadingIndicator.textContent = `Generating image ${page} of ${totalPages}...`;
                const chunk = events.slice(i * eventsPerPage, (i + 1) * eventsPerPage);

                const posterClone = posterContent.cloneNode(true);
                const titleEl = posterClone.querySelector('#preview-title');
                titleEl.textContent = settings.title;
                titleEl.style.fontSize = `${settings.titleFontSize}px`;
                
                posterClone.querySelector('#preview-subtitle').textContent = settings.subtitle;
                
                const overlayEl = posterClone.querySelector('#poster-background-overlay');
                 if(settings.background === 'custom') {
                     overlayEl.style.backgroundImage = `linear-gradient(to bottom right, ${settings.customGradient.start}, ${settings.customGradient.end})`;
                 } else {
                     overlayEl.style.backgroundImage = gradients[settings.background];
                 }

                const listInClone = posterClone.querySelector('.event-list-container');
                listInClone.innerHTML = '';

                chunk.forEach((event, index) => {
                    const eventElement = createEventElement(event, index, false);
                    listInClone.appendChild(eventElement);
                });

                const timestampEl = posterClone.querySelector('#preview-timestamp');
                if (settings.showTimestamp) {
                    timestampEl.textContent = `Generated on: ${new Date().toLocaleString()}`;
                    timestampEl.style.display = 'block';
                } else {
                    timestampEl.style.display = 'none';
                }
                
                const urlEl = posterClone.querySelector('#preview-url');
                if (settings.showUrl) {
                    urlEl.textContent = window.location.href;
                    urlEl.style.display = 'block';
                } else {
                    urlEl.style.display = 'none';
                }

                posterClone.querySelector('#preview-footer').textContent = settings.footer;


                posterClone.style.position = 'absolute';
                posterClone.style.top = '-9999px';
                posterClone.style.left = '0px';
                posterClone.style.zIndex = '-100';
                document.body.appendChild(posterClone);
                
                try {
                    await delay(200);

                    const canvas = await html2canvas(posterClone, {
                        scale: 1, 
                        useCORS: true,
                        logging: false,
                        backgroundColor: null, 
                        width: 1080,
                        height: 1920,
                        windowWidth: 1080,
                        windowHeight: 1920
                    });

                    const link = document.createElement('a');
                    link.download = `event-poster-${page}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    link.remove();
                    await delay(500);
                } catch (err) {
                    console.error('Oops, something went wrong!', err);
                    showAlert('Image Generation Failed', `An error occurred while creating image ${page}. Please try again.`);
                    break;
                } finally {
                    document.body.removeChild(posterClone);
                }
            }

            loadingIndicator.classList.add('hidden');
            loadingIndicator.textContent = `Generating image... please wait.`;
            downloadBtn.disabled = false;
            downloadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        
        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            const datepicker = new Datepicker(eventDateInput, {
                format: 'dd/mm/yyyy',
                autohide: true,
                buttonClass: 'btn'
            }); 
            loadState();
            renderCustomizations();
            renderEventsInPreview();
            updatePreviewSize(); // Initial sizing of the preview
        });
        
        window.addEventListener('resize', updatePreviewSize); // Update preview on window resize


        // Customization listeners
        posterTitleInput.addEventListener('input', e => { settings.title = e.target.value; saveState(); renderCustomizations(); });
        posterSubtitleInput.addEventListener('input', e => { settings.subtitle = e.target.value; saveState(); renderCustomizations(); });
        posterBackgroundSelect.addEventListener('change', e => { settings.background = e.target.value; saveState(); renderCustomizations(); });
        posterFooterInput.addEventListener('input', e => { settings.footer = e.target.value; saveState(); renderCustomizations(); });
        eventsPerPageInput.addEventListener('change', e => { settings.eventsPerPage = parseInt(e.target.value, 10); saveState(); });
        showTimestampCheckbox.addEventListener('change', e => { settings.showTimestamp = e.target.checked; saveState(); });
        showUrlCheckbox.addEventListener('change', e => { settings.showUrl = e.target.checked; saveState(); });
        titleFontSizeSlider.addEventListener('input', e => { settings.titleFontSize = e.target.value; fontSizeValueSpan.textContent = e.target.value; saveState(); renderCustomizations(); });
        gradientStartColorInput.addEventListener('input', e => { settings.customGradient.start = e.target.value; saveState(); renderCustomizations();});
        gradientEndColorInput.addEventListener('input', e => { settings.customGradient.end = e.target.value; saveState(); renderCustomizations();});


        // Event listeners
        eventForm.addEventListener('submit', addEvent);
        isFreeCheckbox.addEventListener('change', () => togglePriceInput('free'));
        isTbaCheckbox.addEventListener('change', () => togglePriceInput('tba'));
        eventPriceInput.addEventListener('input', () => togglePriceInput('input'));

        downloadBtn.addEventListener('click', downloadImage);
        clearBtn.addEventListener('click', clearAllEvents);
        populateBtn.addEventListener('click', populateWithTestData);
        sortBtn.addEventListener('click', () => {
            sortEvents();
            saveState();
            renderEventsInPreview();
        });
        previewListContainer.addEventListener('click', handleListInteraction);
        exportBtn.addEventListener('click', exportData);
        importBtn.addEventListener('click', () => importInput.click());
        importInput.addEventListener('change', importData);

    </script>
</body>
</html>
```

I've made the following changes:

1.  **HTML:** Simplified the structure of the poster preview area to make it easier to control.
2.  **JavaScript:** Added a new function, `updatePreviewSize()`, that precisely calculates the correct scale for the preview based on its container's current size.
3.  **Event Listeners:** This new function is now called when the page first loads and whenever the browser window is resized, ensuring the preview always looks correct.

The preview poster should now fit perfectly within its rounded border on any screen si
